!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core")):"function"==typeof define&&define.amd?define("chess-ts",["exports","@angular/core"],e):e((t=t||self)["chess-ts"]={},t.ng.core)}(this,function(t,e){"use strict";var i={WHITE:"w",BLACK:"b"},r={PAWN:"p",KNIGHT:"n",BISHOP:"b",ROOK:"r",QUEEN:"q",KING:"k"},s=function(){return function(t,e,i){this.from=t,this.to=e,this.promotion=i}}(),o=function(){function t(t){this.EMPTY=-1,this.onChange=new e.EventEmitter,this.SYMBOLS="pnbrqkPNBRQK",this.DEFAULT_POSITION="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",this.POSSIBLE_RESULTS=["1-0","0-1","1/2-1/2","*"],this.PAWN_OFFSETS={b:[16,32,17,15],w:[-16,-32,-17,-15]},this.PIECE_OFFSETS={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},this.ATTACKS=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],this.RAYS=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],this.SHIFTS={p:0,n:1,b:2,r:3,q:4,k:5},this.FLAGS={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},this.BITS={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},this.RANK_1=7,this.RANK_2=6,this.RANK_3=5,this.RANK_4=4,this.RANK_5=3,this.RANK_6=2,this.RANK_7=1,this.RANK_8=0,this.SQUARES={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},this.ROOKS={w:[{square:this.SQUARES.a1,flag:this.BITS.QSIDE_CASTLE},{square:this.SQUARES.h1,flag:this.BITS.KSIDE_CASTLE}],b:[{square:this.SQUARES.a8,flag:this.BITS.QSIDE_CASTLE},{square:this.SQUARES.h8,flag:this.BITS.KSIDE_CASTLE}]},this.board=new Array(128),this.kings={w:this.EMPTY,b:this.EMPTY},this.turn=i.WHITE,this.castling={w:0,b:0},this.ep_square=this.EMPTY,this.half_moves=0,this.move_number=1,this.history=[],this.header={},void 0===t?this.load(this.DEFAULT_POSITION):this.load(t)}return t.prototype.clear=function(){this.board=new Array(128),this.kings={w:this.EMPTY,b:this.EMPTY},this.turn=i.WHITE,this.castling={w:0,b:0},this.ep_square=this.EMPTY,this.half_moves=0,this.move_number=1,this.history=[],this.header={},this.update_setup(this.generate_fen())},t.prototype.reset=function(){this.load(this.DEFAULT_POSITION)},t.prototype.load=function(t){var e=t.split(/\s+/),r=e[0],s=0;if(!this.validate_fen(t).valid)return!1;this.clear();for(var o=0;o<r.length;o++){var n=r.charAt(o);if("/"===n)s+=8;else if(this.is_digit(n))s+=parseInt(n,10);else{var h=n<"a"?i.WHITE:i.BLACK;this.put({type:n.toLowerCase(),color:h},this.algebraic(s)),s++}}return this.turn=e[1],e[2].indexOf("K")>-1&&(this.castling.w|=this.BITS.KSIDE_CASTLE),e[2].indexOf("Q")>-1&&(this.castling.w|=this.BITS.QSIDE_CASTLE),e[2].indexOf("k")>-1&&(this.castling.b|=this.BITS.KSIDE_CASTLE),e[2].indexOf("q")>-1&&(this.castling.b|=this.BITS.QSIDE_CASTLE),this.ep_square="-"===e[3]?this.EMPTY:this.SQUARES[e[3]],this.half_moves=parseInt(e[4],10),this.move_number=parseInt(e[5],10),this.update_setup(this.generate_fen()),this.onChange.emit(),!0},t.prototype.validate_fen=function(t){var e="No errors.",i="FEN string must contain six space-delimited fields.",r="6th field (move number) must be a positive integer.",s="5th field (half move counter) must be a non-negative integer.",o="4th field (en-passant square) is invalid.",n="3rd field (castling availability) is invalid.",h="2nd field (side to move) is invalid.",a="1st field (piece positions) does not contain 8 '/'-delimited rows.",f="1st field (piece positions) is invalid [consecutive numbers].",p="1st field (piece positions) is invalid [invalid piece].",u="1st field (piece positions) is invalid [row too large].",d="Illegal en-passant square",l=t.split(/\s+/);if(6!==l.length)return{valid:!1,error_number:1,error:i};if(isNaN(l[5])||parseInt(l[5],10)<=0)return{valid:!1,error_number:2,error:r};if(isNaN(l[4])||parseInt(l[4],10)<0)return{valid:!1,error_number:3,error:s};if(!/^(-|[abcdefgh][36])$/.test(l[3]))return{valid:!1,error_number:4,error:o};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(l[2]))return{valid:!1,error_number:5,error:n};if(!/^(w|b)$/.test(l[1]))return{valid:!1,error_number:6,error:h};var c=l[0].split("/");if(8!==c.length)return{valid:!1,error_number:7,error:a};for(var _=0;_<c.length;_++){for(var S=0,g=!1,v=0;v<c[_].length;v++)if(isNaN(c[_][v])){if(!/^[prnbqkPRNBQK]$/.test(c[_][v]))return{valid:!1,error_number:9,error:p};S+=1,g=!1}else{if(g)return{valid:!1,error_number:8,error:f};S+=parseInt(c[_][v],10),g=!0}if(8!==S)return{valid:!1,error_number:10,error:u}}return"3"===l[3][1]&&"w"===l[1]||"6"===l[3][1]&&"b"===l[1]?{valid:!1,error_number:11,error:d}:{valid:!0,error_number:0,error:e}},t.prototype.generate_fen=function(){for(var t=0,e="",r=this.SQUARES.a8;r<=this.SQUARES.h1;r++){if(this.board[r]===undefined)t++;else{t>0&&(e+=t,t=0);var s=this.board[r].color,o=this.board[r].type;e+=s===i.WHITE?o.toUpperCase():o.toLowerCase()}r+1&136&&(t>0&&(e+=t),r!==this.SQUARES.h1&&(e+="/"),t=0,r+=8)}var n="";this.castling[i.WHITE]&this.BITS.KSIDE_CASTLE&&(n+="K"),this.castling[i.WHITE]&this.BITS.QSIDE_CASTLE&&(n+="Q"),this.castling[i.BLACK]&this.BITS.KSIDE_CASTLE&&(n+="k"),this.castling[i.BLACK]&this.BITS.QSIDE_CASTLE&&(n+="q"),n=n||"-";var h=this.ep_square===this.EMPTY?"-":this.algebraic(this.ep_square);return[e,this.turn,n,h,this.half_moves,this.move_number].join(" ")},t.prototype.set_header=function(t){for(var e=0;e<t.length;e+=2)"string"==typeof t[e]&&"string"==typeof t[e+1]&&(this.header[t[e]]=t[e+1]);return this.header},t.prototype.update_setup=function(t){history.length>0||(t!==this.DEFAULT_POSITION?(this.header.SetUp="1",this.header.FEN=t):(delete this.header.SetUp,delete this.header.FEN))},t.prototype.get=function(t){var e=this.board[this.SQUARES[t]];return e?{type:e.type,color:e.color}:undefined},t.prototype.put=function(t,e){if(!("type"in t&&"color"in t))return!1;if(-1===this.SYMBOLS.indexOf(t.type.toLowerCase()))return!1;if(!(e in this.SQUARES))return!1;var i=this.SQUARES[e];return(t.type!==r.KING||this.kings[t.color]===this.EMPTY||this.kings[t.color]===i)&&(this.board[i]={type:t.type,color:t.color},t.type===r.KING&&(this.kings[t.color]=i),this.update_setup(this.generate_fen()),!0)},t.prototype.remove=function(t){var e=this.get(t);return this.board[this.SQUARES[t]]=undefined,e&&e.type===r.KING&&(this.kings[e.color]=this.EMPTY),this.update_setup(this.generate_fen()),e},t.prototype.build_move=function(t,e,i,s,o){var n={color:this.turn,from:e,to:i,flags:s,piece:t[e].type,promotion:undefined,captured:undefined};return o&&(n.flags|=this.BITS.PROMOTION,n.promotion=o),t[i]?n.captured=t[i].type:s&this.BITS.EP_CAPTURE&&(n.captured=r.PAWN),n},t.prototype.add_move=function(t,e,i,s,o){if(t[i].type!==r.PAWN||this.rank(s)!==this.RANK_8&&this.rank(s)!==this.RANK_1)e.push(this.build_move(t,i,s,o));else for(var n=[r.QUEEN,r.ROOK,r.BISHOP,r.KNIGHT],h=0,a=n.length;h<a;h++)e.push(this.build_move(t,i,s,o,n[h]))},t.prototype.generate_moves=function(t){var e=[],i=this.turn,s=this.swap_color(i),o={b:this.RANK_7,w:this.RANK_2},n=this.SQUARES.a8,h=this.SQUARES.h1,a=!1,f=!(void 0!==t&&"legal"in t)||t.legal;if(void 0!==t&&"square"in t){if(!(t.square in this.SQUARES))return[];n=h=this.SQUARES[t.square],a=!0}for(var p=n;p<=h;p++)if(136&p)p+=7;else{var u=this.board[p];if(u!==undefined&&u.color===i)if(u.type===r.PAWN){var d=p+this.PAWN_OFFSETS[i][0];if(this.board[d]===undefined){this.add_move(this.board,e,p,d,this.BITS.NORMAL);var l=p+this.PAWN_OFFSETS[i][1];o[i]===this.rank(p)&&this.board[l]===undefined&&this.add_move(this.board,e,p,l,this.BITS.BIG_PAWN)}for(var c=2;c<4;c++){136&(l=p+this.PAWN_OFFSETS[i][c])||(this.board[l]!==undefined&&this.board[l].color===s?this.add_move(this.board,e,p,l,this.BITS.CAPTURE):l===this.ep_square&&this.add_move(this.board,e,p,this.ep_square,this.BITS.EP_CAPTURE))}}else{c=0;for(var _=this.PIECE_OFFSETS[u.type].length;c<_;c++){var S=this.PIECE_OFFSETS[u.type][c];for(l=p;!(136&(l+=S));){if(this.board[l]!==undefined){if(this.board[l].color===i)break;this.add_move(this.board,e,p,l,this.BITS.CAPTURE);break}if(this.add_move(this.board,e,p,l,this.BITS.NORMAL),"n"===u.type||"k"===u.type)break}}}}if(!a||h===this.kings[i]){if(this.castling[i]&this.BITS.KSIDE_CASTLE){var g=(v=this.kings[i])+2;this.board[v+1]!==undefined||this.board[g]!==undefined||this.attacked(s,this.kings[i])||this.attacked(s,v+1)||this.attacked(s,g)||this.add_move(this.board,e,this.kings[i],g,this.BITS.KSIDE_CASTLE)}if(this.castling[i]&this.BITS.QSIDE_CASTLE){var v;g=(v=this.kings[i])-2;this.board[v-1]!==undefined||this.board[v-2]!==undefined||this.board[v-3]!==undefined||this.attacked(s,this.kings[i])||this.attacked(s,v-1)||this.attacked(s,g)||this.add_move(this.board,e,this.kings[i],g,this.BITS.QSIDE_CASTLE)}}if(!f)return e;var m=[];for(p=0,_=e.length;p<_;p++)this.make_move(e[p]),this.king_attacked(i)||m.push(e[p]),this.undo_move();return m},t.prototype.move_to_san=function(t,e){var i="";if(t.flags&this.BITS.KSIDE_CASTLE)i="O-O";else if(t.flags&this.BITS.QSIDE_CASTLE)i="O-O-O";else{var s=this.get_disambiguator(t,e);t.piece!==r.PAWN&&(i+=t.piece.toUpperCase()+s),t.flags&(this.BITS.CAPTURE|this.BITS.EP_CAPTURE)&&(t.piece===r.PAWN&&(i+=this.algebraic(t.from)[0]),i+="x"),i+=this.algebraic(t.to),t.flags&this.BITS.PROMOTION&&(i+="="+t.promotion.toUpperCase())}return this.make_move(t),this.in_check()&&(this.in_checkmate()?i+="#":i+="+"),this.undo_move(),i},t.prototype.stripped_san=function(t){return t.replace(/=/,"").replace(/[+#]?[?!]*$/,"")},t.prototype.attacked=function(t,e){for(var s=this.SQUARES.a8;s<=this.SQUARES.h1;s++)if(136&s)s+=7;else if(this.board[s]!==undefined&&this.board[s].color===t){var o=this.board[s],n=s-e,h=n+119;if(this.ATTACKS[h]&1<<this.SHIFTS[o.type]){if(o.type===r.PAWN){if(n>0){if(o.color===i.WHITE)return!0}else if(o.color===i.BLACK)return!0;continue}if("n"===o.type||"k"===o.type)return!0;for(var a=this.RAYS[h],f=s+a,p=!1;f!==e;){if(this.board[f]!==undefined){p=!0;break}f+=a}if(!p)return!0}}return!1},t.prototype.king_attacked=function(t){return this.attacked(this.swap_color(t),this.kings[t])},t.prototype.in_check=function(){return this.king_attacked(this.turn)},t.prototype.in_checkmate=function(){return this.in_check()&&0===this.generate_moves().length},t.prototype.in_stalemate=function(){return!this.in_check()&&0===this.generate_moves().length},t.prototype.insufficient_material=function(){for(var t={},e=[],i=0,s=0,o=this.SQUARES.a8;o<=this.SQUARES.h1;o++)if(s=(s+1)%2,136&o)o+=7;else{var n=this.board[o];n&&(t[n.type]=n.type in t?t[n.type]+1:1,n.type===r.BISHOP&&e.push(s),i++)}if(2===i)return!0;if(3===i&&(1===t[r.BISHOP]||1===t[r.KNIGHT]))return!0;if(i===t[r.BISHOP]+2){var h=0,a=e.length;for(o=0;o<a;o++)h+=e[o];if(0===h||h===a)return!0}return!1},t.prototype.in_threefold_repetition=function(){for(var t=[],e={},i=!1;;){var r=this.undo_move();if(!r)break;t.push(r)}for(;;){var s=this.generate_fen().split(" ").slice(0,4).join(" ");if(e[s]=s in e?e[s]+1:1,e[s]>=3&&(i=!0),!t.length)break;this.make_move(t.pop())}return i},t.prototype.push=function(t){this.history.push({move:t,kings:{b:this.kings.b,w:this.kings.w},turn:this.turn,castling:{b:this.castling.b,w:this.castling.w},ep_square:this.ep_square,half_moves:this.half_moves,move_number:this.move_number})},t.prototype.make_move=function(t){var e=this.turn,s=this.swap_color(e);if(this.push(t),this.board[t.to]=this.board[t.from],this.board[t.from]=undefined,t.flags&this.BITS.EP_CAPTURE&&(this.turn===i.BLACK?this.board[t.to-16]=undefined:this.board[t.to+16]=undefined),t.flags&this.BITS.PROMOTION&&(this.board[t.to]={type:t.promotion,color:e}),this.board[t.to].type===r.KING){if(this.kings[this.board[t.to].color]=t.to,t.flags&this.BITS.KSIDE_CASTLE){var o=t.to-1,n=t.to+1;this.board[o]=this.board[n],this.board[n]=undefined}else if(t.flags&this.BITS.QSIDE_CASTLE){var h=t.to+1,a=t.to-2;this.board[h]=this.board[a],this.board[a]=undefined}this.castling[e]=""}if(this.castling[e])for(var f=0,p=this.ROOKS[e].length;f<p;f++)if(t.from===this.ROOKS[e][f].square&&this.castling[e]&this.ROOKS[e][f].flag){this.castling[e]^=this.ROOKS[e][f].flag;break}if(this.castling[s])for(f=0,p=this.ROOKS[s].length;f<p;f++)if(t.to===this.ROOKS[s][f].square&&this.castling[s]&this.ROOKS[s][f].flag){this.castling[s]^=this.ROOKS[s][f].flag;break}t.flags&this.BITS.BIG_PAWN?"b"===this.turn?this.ep_square=t.to-16:this.ep_square=t.to+16:this.ep_square=this.EMPTY,t.piece===r.PAWN?this.half_moves=0:t.flags&(this.BITS.CAPTURE|this.BITS.EP_CAPTURE)?this.half_moves=0:this.half_moves++,this.turn===i.BLACK&&this.move_number++,this.turn=this.swap_color(this.turn)},t.prototype.undo_move=function(){var t=this.history.pop();if(t===undefined)return undefined;var e=t.move;this.kings=t.kings,this.turn=t.turn,this.castling=t.castling,this.ep_square=t.ep_square,this.half_moves=t.half_moves,this.move_number=t.move_number;var s=this.turn,o=this.swap_color(this.turn);if(this.board[e.from]=this.board[e.to],this.board[e.from].type=e.piece,this.board[e.to]=undefined,e.flags&this.BITS.CAPTURE)this.board[e.to]={type:e.captured,color:o};else if(e.flags&this.BITS.EP_CAPTURE){var n=void 0;n=s===i.BLACK?e.to-16:e.to+16,this.board[n]={type:r.PAWN,color:o}}if(e.flags&(this.BITS.KSIDE_CASTLE|this.BITS.QSIDE_CASTLE)){var h=void 0,a=void 0;e.flags&this.BITS.KSIDE_CASTLE?(h=e.to+1,a=e.to-1):e.flags&this.BITS.QSIDE_CASTLE&&(h=e.to-2,a=e.to+1),this.board[h]=this.board[a],this.board[a]=undefined}return e},t.prototype.get_disambiguator=function(t,e){for(var i=this.generate_moves({legal:!e}),r=t.from,s=t.to,o=t.piece,n=0,h=0,a=0,f=0,p=i.length;f<p;f++){var u=i[f].from,d=i[f].to;o===i[f].piece&&r!==u&&s===d&&(n++,this.rank(r)===this.rank(u)&&h++,this.file(r)===this.file(u)&&a++)}return n>0?h>0&&a>0?this.algebraic(r):a>0?this.algebraic(r).charAt(1):this.algebraic(r).charAt(0):""},t.prototype.ascii=function(){for(var t="   +------------------------+\n",e=this.SQUARES.a8;e<=this.SQUARES.h1;e++){if(0===this.file(e)&&(t+=" "+"87654321"[this.rank(e)]+" |"),this.board[e]===undefined)t+=" . ";else{var r=this.board[e].type;t+=" "+(this.board[e].color===i.WHITE?r.toUpperCase():r.toLowerCase())+" "}e+1&136&&(t+="|\n",e+=8)}return t+="   +------------------------+\n",t+="     a  b  c  d  e  f  g  h\n"},t.prototype.move_from_san=function(t,e){var i,r,s,o,n=this.stripped_san(t),h=n.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);e&&h&&(i=h[1],r=h[2],s=h[3],o=h[4]);for(var a=this.generate_moves(),f=0,p=a.length;f<p;f++){if(n===this.stripped_san(this.move_to_san(a[f]))||e&&n===this.stripped_san(this.move_to_san(a[f],!0)))return a[f];if(h&&(!i||i.toLowerCase()===a[f].piece)&&this.SQUARES[r]===a[f].from&&this.SQUARES[s]===a[f].to&&(!o||o.toLowerCase()===a[f].promotion))return a[f]}return undefined},t.prototype.rank=function(t){return t>>4},t.prototype.file=function(t){return 15&t},t.prototype.algebraic=function(t){var e=this.file(t),i=this.rank(t);return"abcdefgh".substring(e,e+1)+"87654321".substring(i,i+1)},t.prototype.swap_color=function(t){return t===i.WHITE?i.BLACK:i.WHITE},t.prototype.is_digit=function(t){return-1!=="0123456789".indexOf(t)},t.prototype.make_pretty=function(t){var e=this.clone(t);e.san=this.move_to_san(e,!1),e.to=this.algebraic(e.to),e.from=this.algebraic(e.from);var i="";for(var r in this.BITS)this.BITS[r]&e.flags&&(i+=this.FLAGS[r]);return e.flags=i,e},t.prototype.clone=function(t){var e=t instanceof Array?[]:{};for(var i in t)e[i]="object"==typeof i?this.clone(t[i]):t[i];return e},t.prototype.trim=function(t){return t.replace(/^\s+|\s+$/g,"")},t.prototype.perft=function(t){for(var e=this.generate_moves({legal:!1}),i=0,r=this.turn,s=0,o=e.length;s<o;s++){if(this.make_move(e[s]),!this.king_attacked(r))if(t-1>0)i+=this.perft(t-1);else i++;this.undo_move()}return i},t.prototype.getSquares=function(){for(var t=[],e=this.SQUARES.a8;e<=this.SQUARES.h1;e++)136&e?e+=7:t.push(this.algebraic(e));return t},t.prototype.getMoves=function(t){for(var e=this.generate_moves(t),i=[],r=0,s=e.length;r<s;r++)void 0!==t&&"verbose"in t&&t.verbose?i.push(this.make_pretty(e[r])):i.push(this.move_to_san(e[r],!1));return i},Object.defineProperty(t.prototype,"in_draw",{get:function(){return this.half_moves>=100||this.in_stalemate()||this.insufficient_material()||this.in_threefold_repetition()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"game_over",{get:function(){return this.half_moves>=100||this.in_checkmate()||this.in_stalemate()||this.insufficient_material()||this.in_threefold_repetition()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fen",{get:function(){return this.generate_fen()},enumerable:!0,configurable:!0}),t.prototype.getPgn=function(t){var e="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\n",i="object"==typeof t&&"number"==typeof t.max_width?t.max_width:0,r=[],s=!1;for(var o in this.header)r.push("["+o+' "'+this.header[o]+'"]'+e),s=!0;s&&history.length&&r.push(e);for(var n=[];history.length>0;)n.push(this.undo_move());for(var h=[],a="";n.length>0;){var f=n.pop();history.length||"b"!==f.color?"w"===f.color&&(a.length&&h.push(a),a=this.move_number+"."):a=this.move_number+". ...",a=a+" "+this.move_to_san(f,!1),this.make_move(f)}if(a.length&&h.push(a),"undefined"!=typeof this.header.Result&&h.push(this.header.Result),0===i)return r.join("")+h.join(" ");for(var p=0,u=0;u<h.length;u++)p+h[u].length>i&&0!==u?(" "===r[r.length-1]&&r.pop(),r.push(e),p=0):0!==u&&(r.push(" "),p++),r.push(h[u]),p+=h[u].length;return r.join("")},t.prototype.load_pgn=function(t,e){var i=void 0!==e&&"sloppy"in e&&e.sloppy;function r(t){return t.replace(/\\/g,"\\")}var s="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",o=new RegExp("^(\\[(.|"+r(s)+")*\\])("+r(s)+")*1.("+r(s)+"|.)*$","g"),n=t.replace(o,"$1");"["!==n[0]&&(n=""),this.reset();var h=function(t,e){for(var i="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",s={},o=t.split(new RegExp(r(i))),n="",h="",a=0;a<o.length;a++)n=o[a].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),h=o[a].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),this.trim(n).length>0&&(s[n]=h);return s}(n,e);for(var a in h)this.set_header([a,h[a]]);if("1"===h.SetUp&&!("FEN"in h&&this.load(h.FEN)))return!1;var f=t.replace(n,"").replace(new RegExp(r(s),"g")," ");f=f.replace(/(\{[^}]+\})+?/g,"");for(var p=/(\([^\(\)]+\))+?/g;p.test(f);)f=f.replace(p,"");f=(f=(f=f.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"");var u=this.trim(f).split(new RegExp(/\s+/));u=u.join(",").replace(/,,+/g,",").split(",");for(var d="",l=0;l<u.length-1;l++){if((d=this.move_from_san(u[l],i))===undefined)return!1;this.make_move(d)}if(d=u[u.length-1],this.POSSIBLE_RESULTS.indexOf(d)>-1)(function(t){for(var e in t)return!0;return!1})(this.header)&&"undefined"==typeof this.header.Result&&this.set_header(["Result",d]);else{if((d=this.move_from_san(d,i))===undefined)return!1;this.make_move(d)}return!0},t.prototype.getHeader=function(){return this.set_header(arguments)},t.prototype.move=function(t,e){var i,r=void 0!==e&&"sloppy"in e&&e.sloppy;if("string"==typeof t)i=this.move_from_san(t,r);else if("object"==typeof t)for(var s=this.generate_moves(),o=0,n=s.length;o<n;o++)if(!(t.from!==this.algebraic(s[o].from)||t.to!==this.algebraic(s[o].to)||"promotion"in s[o]&&t.promotion!==s[o].promotion)){i=s[o];break}if(!i)return undefined;var h=this.make_pretty(i);return this.make_move(i),this.onChange.emit(),h},t.prototype.undo=function(){var t=this.undo_move();return this.onChange.emit(),t?this.make_pretty(t):undefined},t.prototype.square_color=function(t){if(t in this.SQUARES){var e=this.SQUARES[t];return(this.rank(e)+this.file(e))%2==0?"light":"dark"}return undefined},t.prototype.getHistory=function(t){for(var e=[],i=[],r=(void 0!==t&&"verbose"in t&&t.verbose);history.length>0;)e.push(this.undo_move());for(;e.length>0;){var s=e.pop();r?i.push(this.make_pretty(s)):i.push(this.move_to_san(s)),this.make_move(s)}return i},t}(),n=function(){return function(){}}(),h=function(){return function(){}}();t.Chess=o,t.ChessPiece=h,t.Colour=i,t.FenValidationResult=n,t.Move=s,t.PieceType=r,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=chess-ts.umd.min.js.map