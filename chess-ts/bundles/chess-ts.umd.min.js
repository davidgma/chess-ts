!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core")):"function"==typeof define&&define.amd?define("chess-ts",["exports","@angular/core"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["chess-ts"]={},t.ng.core)}(this,(function(t,e){"use strict";var i,r;(i=t.Colour||(t.Colour={})).WHITE="w",i.BLACK="b",(r=t.PieceType||(t.PieceType={})).PAWN="p",r.KNIGHT="n",r.BISHOP="b",r.ROOK="r",r.QUEEN="q",r.KING="k";var s=function(t,e,i){this.from=t,this.to=e,this.promotion=i},o=function(){function i(i){this.EMPTY=-1,this.onChange=new e.EventEmitter,this.SYMBOLS="pnbrqkPNBRQK",this.DEFAULT_POSITION="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",this.POSSIBLE_RESULTS=["1-0","0-1","1/2-1/2","*"],this.PAWN_OFFSETS={b:[16,32,17,15],w:[-16,-32,-17,-15]},this.PIECE_OFFSETS={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},this.ATTACKS=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],this.RAYS=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],this.SHIFTS={p:0,n:1,b:2,r:3,q:4,k:5},this.FLAGS={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},this.BITS={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},this.RANK_1=7,this.RANK_2=6,this.RANK_3=5,this.RANK_4=4,this.RANK_5=3,this.RANK_6=2,this.RANK_7=1,this.RANK_8=0,this.SQUARES={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},this.ROOKS={w:[{square:this.SQUARES.a1,flag:this.BITS.QSIDE_CASTLE},{square:this.SQUARES.h1,flag:this.BITS.KSIDE_CASTLE}],b:[{square:this.SQUARES.a8,flag:this.BITS.QSIDE_CASTLE},{square:this.SQUARES.h8,flag:this.BITS.KSIDE_CASTLE}]},this.board=new Array(128),this.kings={w:this.EMPTY,b:this.EMPTY},this.turn=t.Colour.WHITE,this.castling={w:0,b:0},this.ep_square=this.EMPTY,this.half_moves=0,this.move_number=1,this.history=[],this.header={},void 0===i?this.load(this.DEFAULT_POSITION):this.load(i)}return i.prototype.clear=function(){this.board=new Array(128),this.kings={w:this.EMPTY,b:this.EMPTY},this.turn=t.Colour.WHITE,this.castling={w:0,b:0},this.ep_square=this.EMPTY,this.half_moves=0,this.move_number=1,this.history=[],this.header={},this.update_setup(this.generate_fen())},i.prototype.reset=function(){this.load(this.DEFAULT_POSITION)},i.prototype.load=function(e){var i=e.split(/\s+/),r=i[0],s=0;if(!this.validate_fen(e).valid)return!1;this.clear();for(var o=0;o<r.length;o++){var h=r.charAt(o);if("/"===h)s+=8;else if(this.is_digit(h))s+=parseInt(h,10);else{var n=h<"a"?t.Colour.WHITE:t.Colour.BLACK;this.put({type:h.toLowerCase(),color:n},this.algebraic(s)),s++}}return this.turn=i[1],i[2].indexOf("K")>-1&&(this.castling.w|=this.BITS.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(this.castling.w|=this.BITS.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(this.castling.b|=this.BITS.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(this.castling.b|=this.BITS.QSIDE_CASTLE),this.ep_square="-"===i[3]?this.EMPTY:this.SQUARES[i[3]],this.half_moves=parseInt(i[4],10),this.move_number=parseInt(i[5],10),this.update_setup(this.generate_fen()),this.onChange.emit(),!0},i.prototype.validate_fen=function(t){var e="No errors.",i="FEN string must contain six space-delimited fields.",r="6th field (move number) must be a positive integer.",s="5th field (half move counter) must be a non-negative integer.",o="4th field (en-passant square) is invalid.",h="3rd field (castling availability) is invalid.",n="2nd field (side to move) is invalid.",a="1st field (piece positions) does not contain 8 '/'-delimited rows.",p="1st field (piece positions) is invalid [consecutive numbers].",f="1st field (piece positions) is invalid [invalid piece].",l="1st field (piece positions) is invalid [row too large].",u="Illegal en-passant square",c=t.split(/\s+/);if(6!==c.length)return{valid:!1,error_number:1,error:i};if(isNaN(c[5])||parseInt(c[5],10)<=0)return{valid:!1,error_number:2,error:r};if(isNaN(c[4])||parseInt(c[4],10)<0)return{valid:!1,error_number:3,error:s};if(!/^(-|[abcdefgh][36])$/.test(c[3]))return{valid:!1,error_number:4,error:o};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(c[2]))return{valid:!1,error_number:5,error:h};if(!/^(w|b)$/.test(c[1]))return{valid:!1,error_number:6,error:n};var d=c[0].split("/");if(8!==d.length)return{valid:!1,error_number:7,error:a};for(var _=0;_<d.length;_++){for(var v=0,S=!1,g=0;g<d[_].length;g++)if(isNaN(d[_][g])){if(!/^[prnbqkPRNBQK]$/.test(d[_][g]))return{valid:!1,error_number:9,error:f};v+=1,S=!1}else{if(S)return{valid:!1,error_number:8,error:p};v+=parseInt(d[_][g],10),S=!0}if(8!==v)return{valid:!1,error_number:10,error:l}}return"3"===c[3][1]&&"w"===c[1]||"6"===c[3][1]&&"b"===c[1]?{valid:!1,error_number:11,error:u}:{valid:!0,error_number:0,error:e}},i.prototype.generate_fen=function(){for(var e=0,i="",r=this.SQUARES.a8;r<=this.SQUARES.h1;r++){if(void 0===this.board[r])e++;else{e>0&&(i+=e,e=0);var s=this.board[r].color,o=this.board[r].type;i+=s===t.Colour.WHITE?o.toUpperCase():o.toLowerCase()}r+1&136&&(e>0&&(i+=e),r!==this.SQUARES.h1&&(i+="/"),e=0,r+=8)}var h="";this.castling[t.Colour.WHITE]&this.BITS.KSIDE_CASTLE&&(h+="K"),this.castling[t.Colour.WHITE]&this.BITS.QSIDE_CASTLE&&(h+="Q"),this.castling[t.Colour.BLACK]&this.BITS.KSIDE_CASTLE&&(h+="k"),this.castling[t.Colour.BLACK]&this.BITS.QSIDE_CASTLE&&(h+="q"),h=h||"-";var n=this.ep_square===this.EMPTY?"-":this.algebraic(this.ep_square);return[i,this.turn,h,n,this.half_moves,this.move_number].join(" ")},i.prototype.set_header=function(t){for(var e=0;e<t.length;e+=2)"string"==typeof t[e]&&"string"==typeof t[e+1]&&(this.header[t[e]]=t[e+1]);return this.header},i.prototype.update_setup=function(t){history.length>0||(t!==this.DEFAULT_POSITION?(this.header.SetUp="1",this.header.FEN=t):(delete this.header.SetUp,delete this.header.FEN))},i.prototype.get=function(t){var e=this.board[this.SQUARES[t]];return e?{type:e.type,color:e.color}:void 0},i.prototype.put=function(e,i){if(!("type"in e)||!("color"in e))return!1;if(-1===this.SYMBOLS.indexOf(e.type.toLowerCase()))return!1;if(!(i in this.SQUARES))return!1;var r=this.SQUARES[i];return(e.type!==t.PieceType.KING||this.kings[e.color]===this.EMPTY||this.kings[e.color]===r)&&(this.board[r]={type:e.type,color:e.color},e.type===t.PieceType.KING&&(this.kings[e.color]=r),this.update_setup(this.generate_fen()),!0)},i.prototype.remove=function(e){var i=this.get(e);return this.board[this.SQUARES[e]]=void 0,i&&i.type===t.PieceType.KING&&(this.kings[i.color]=this.EMPTY),this.update_setup(this.generate_fen()),i},i.prototype.build_move=function(e,i,r,s,o){var h={color:this.turn,from:i,to:r,flags:s,piece:e[i].type,promotion:void 0,captured:void 0};return o&&(h.flags|=this.BITS.PROMOTION,h.promotion=o),e[r]?h.captured=e[r].type:s&this.BITS.EP_CAPTURE&&(h.captured=t.PieceType.PAWN),h},i.prototype.add_move=function(e,i,r,s,o){if(e[r].type!==t.PieceType.PAWN||this.rank(s)!==this.RANK_8&&this.rank(s)!==this.RANK_1)i.push(this.build_move(e,r,s,o));else for(var h=[t.PieceType.QUEEN,t.PieceType.ROOK,t.PieceType.BISHOP,t.PieceType.KNIGHT],n=0,a=h.length;n<a;n++)i.push(this.build_move(e,r,s,o,h[n]))},i.prototype.generate_moves=function(e){var i=[],r=this.turn,s=this.swap_color(r),o={b:this.RANK_7,w:this.RANK_2},h=this.SQUARES.a8,n=this.SQUARES.h1,a=!1,p=void 0===e||!("legal"in e)||e.legal;if(void 0!==e&&"square"in e){if(!(e.square in this.SQUARES))return[];h=n=this.SQUARES[e.square],a=!0}for(var f=h;f<=n;f++)if(136&f)f+=7;else{var l=this.board[f];if(void 0!==l&&l.color===r)if(l.type===t.PieceType.PAWN){var u=f+this.PAWN_OFFSETS[r][0];if(void 0===this.board[u]){this.add_move(this.board,i,f,u,this.BITS.NORMAL);var c=f+this.PAWN_OFFSETS[r][1];o[r]===this.rank(f)&&void 0===this.board[c]&&this.add_move(this.board,i,f,c,this.BITS.BIG_PAWN)}for(var d=2;d<4;d++){136&(c=f+this.PAWN_OFFSETS[r][d])||(void 0!==this.board[c]&&this.board[c].color===s?this.add_move(this.board,i,f,c,this.BITS.CAPTURE):c===this.ep_square&&this.add_move(this.board,i,f,this.ep_square,this.BITS.EP_CAPTURE))}}else{d=0;for(var _=this.PIECE_OFFSETS[l.type].length;d<_;d++){var v=this.PIECE_OFFSETS[l.type][d];for(c=f;!(136&(c+=v));){if(void 0!==this.board[c]){if(this.board[c].color===r)break;this.add_move(this.board,i,f,c,this.BITS.CAPTURE);break}if(this.add_move(this.board,i,f,c,this.BITS.NORMAL),"n"===l.type||"k"===l.type)break}}}}if(!a||n===this.kings[r]){if(this.castling[r]&this.BITS.KSIDE_CASTLE){var S=(g=this.kings[r])+2;void 0!==this.board[g+1]||void 0!==this.board[S]||this.attacked(s,this.kings[r])||this.attacked(s,g+1)||this.attacked(s,S)||this.add_move(this.board,i,this.kings[r],S,this.BITS.KSIDE_CASTLE)}if(this.castling[r]&this.BITS.QSIDE_CASTLE){var g;S=(g=this.kings[r])-2;void 0!==this.board[g-1]||void 0!==this.board[g-2]||void 0!==this.board[g-3]||this.attacked(s,this.kings[r])||this.attacked(s,g-1)||this.attacked(s,S)||this.add_move(this.board,i,this.kings[r],S,this.BITS.QSIDE_CASTLE)}}if(!p)return i;var m=[];for(f=0,_=i.length;f<_;f++)this.make_move(i[f]),this.king_attacked(r)||m.push(i[f]),this.undo_move();return m},i.prototype.move_to_san=function(e,i){var r="";if(e.flags&this.BITS.KSIDE_CASTLE)r="O-O";else if(e.flags&this.BITS.QSIDE_CASTLE)r="O-O-O";else{var s=this.get_disambiguator(e,i);e.piece!==t.PieceType.PAWN&&(r+=e.piece.toUpperCase()+s),e.flags&(this.BITS.CAPTURE|this.BITS.EP_CAPTURE)&&(e.piece===t.PieceType.PAWN&&(r+=this.algebraic(e.from)[0]),r+="x"),r+=this.algebraic(e.to),e.flags&this.BITS.PROMOTION&&(r+="="+e.promotion.toUpperCase())}return this.make_move(e),this.in_check()&&(this.in_checkmate()?r+="#":r+="+"),this.undo_move(),r},i.prototype.stripped_san=function(t){return t.replace(/=/,"").replace(/[+#]?[?!]*$/,"")},i.prototype.attacked=function(e,i){for(var r=this.SQUARES.a8;r<=this.SQUARES.h1;r++)if(136&r)r+=7;else if(void 0!==this.board[r]&&this.board[r].color===e){var s=this.board[r],o=r-i,h=o+119;if(this.ATTACKS[h]&1<<this.SHIFTS[s.type]){if(s.type===t.PieceType.PAWN){if(o>0){if(s.color===t.Colour.WHITE)return!0}else if(s.color===t.Colour.BLACK)return!0;continue}if("n"===s.type||"k"===s.type)return!0;for(var n=this.RAYS[h],a=r+n,p=!1;a!==i;){if(void 0!==this.board[a]){p=!0;break}a+=n}if(!p)return!0}}return!1},i.prototype.king_attacked=function(t){return this.attacked(this.swap_color(t),this.kings[t])},i.prototype.in_check=function(){return this.king_attacked(this.turn)},i.prototype.in_checkmate=function(){return this.in_check()&&0===this.generate_moves().length},i.prototype.in_stalemate=function(){return!this.in_check()&&0===this.generate_moves().length},i.prototype.insufficient_material=function(){for(var e={},i=[],r=0,s=0,o=this.SQUARES.a8;o<=this.SQUARES.h1;o++)if(s=(s+1)%2,136&o)o+=7;else{var h=this.board[o];h&&(e[h.type]=h.type in e?e[h.type]+1:1,h.type===t.PieceType.BISHOP&&i.push(s),r++)}if(2===r)return!0;if(3===r&&(1===e[t.PieceType.BISHOP]||1===e[t.PieceType.KNIGHT]))return!0;if(r===e[t.PieceType.BISHOP]+2){var n=0,a=i.length;for(o=0;o<a;o++)n+=i[o];if(0===n||n===a)return!0}return!1},i.prototype.in_threefold_repetition=function(){for(var t=[],e={},i=!1;;){var r=this.undo_move();if(!r)break;t.push(r)}for(;;){var s=this.generate_fen().split(" ").slice(0,4).join(" ");if(e[s]=s in e?e[s]+1:1,e[s]>=3&&(i=!0),!t.length)break;this.make_move(t.pop())}return i},i.prototype.push=function(t){this.history.push({move:t,kings:{b:this.kings.b,w:this.kings.w},turn:this.turn,castling:{b:this.castling.b,w:this.castling.w},ep_square:this.ep_square,half_moves:this.half_moves,move_number:this.move_number})},i.prototype.make_move=function(e){var i=this.turn,r=this.swap_color(i);if(this.push(e),this.board[e.to]=this.board[e.from],this.board[e.from]=void 0,e.flags&this.BITS.EP_CAPTURE&&(this.turn===t.Colour.BLACK?this.board[e.to-16]=void 0:this.board[e.to+16]=void 0),e.flags&this.BITS.PROMOTION&&(this.board[e.to]={type:e.promotion,color:i}),this.board[e.to].type===t.PieceType.KING){if(this.kings[this.board[e.to].color]=e.to,e.flags&this.BITS.KSIDE_CASTLE){var s=e.to-1,o=e.to+1;this.board[s]=this.board[o],this.board[o]=void 0}else if(e.flags&this.BITS.QSIDE_CASTLE){var h=e.to+1,n=e.to-2;this.board[h]=this.board[n],this.board[n]=void 0}this.castling[i]=""}if(this.castling[i])for(var a=0,p=this.ROOKS[i].length;a<p;a++)if(e.from===this.ROOKS[i][a].square&&this.castling[i]&this.ROOKS[i][a].flag){this.castling[i]^=this.ROOKS[i][a].flag;break}if(this.castling[r])for(a=0,p=this.ROOKS[r].length;a<p;a++)if(e.to===this.ROOKS[r][a].square&&this.castling[r]&this.ROOKS[r][a].flag){this.castling[r]^=this.ROOKS[r][a].flag;break}e.flags&this.BITS.BIG_PAWN?"b"===this.turn?this.ep_square=e.to-16:this.ep_square=e.to+16:this.ep_square=this.EMPTY,e.piece===t.PieceType.PAWN||e.flags&(this.BITS.CAPTURE|this.BITS.EP_CAPTURE)?this.half_moves=0:this.half_moves++,this.turn===t.Colour.BLACK&&this.move_number++,this.turn=this.swap_color(this.turn)},i.prototype.undo_move=function(){var e=this.history.pop();if(void 0!==e){var i=e.move;this.kings=e.kings,this.turn=e.turn,this.castling=e.castling,this.ep_square=e.ep_square,this.half_moves=e.half_moves,this.move_number=e.move_number;var r=this.turn,s=this.swap_color(this.turn);if(this.board[i.from]=this.board[i.to],this.board[i.from].type=i.piece,this.board[i.to]=void 0,i.flags&this.BITS.CAPTURE)this.board[i.to]={type:i.captured,color:s};else if(i.flags&this.BITS.EP_CAPTURE){var o=void 0;o=r===t.Colour.BLACK?i.to-16:i.to+16,this.board[o]={type:t.PieceType.PAWN,color:s}}if(i.flags&(this.BITS.KSIDE_CASTLE|this.BITS.QSIDE_CASTLE)){var h=void 0,n=void 0;i.flags&this.BITS.KSIDE_CASTLE?(h=i.to+1,n=i.to-1):i.flags&this.BITS.QSIDE_CASTLE&&(h=i.to-2,n=i.to+1),this.board[h]=this.board[n],this.board[n]=void 0}return i}},i.prototype.get_disambiguator=function(t,e){for(var i=this.generate_moves({legal:!e}),r=t.from,s=t.to,o=t.piece,h=0,n=0,a=0,p=0,f=i.length;p<f;p++){var l=i[p].from,u=i[p].to;o===i[p].piece&&r!==l&&s===u&&(h++,this.rank(r)===this.rank(l)&&n++,this.file(r)===this.file(l)&&a++)}return h>0?n>0&&a>0?this.algebraic(r):a>0?this.algebraic(r).charAt(1):this.algebraic(r).charAt(0):""},i.prototype.ascii=function(){for(var e="   +------------------------+\n",i=this.SQUARES.a8;i<=this.SQUARES.h1;i++){if(0===this.file(i)&&(e+=" "+"87654321"[this.rank(i)]+" |"),void 0===this.board[i])e+=" . ";else{var r=this.board[i].type;e+=" "+(this.board[i].color===t.Colour.WHITE?r.toUpperCase():r.toLowerCase())+" "}i+1&136&&(e+="|\n",i+=8)}return e+="   +------------------------+\n",e+="     a  b  c  d  e  f  g  h\n"},i.prototype.move_from_san=function(t,e){var i,r,s,o,h=this.stripped_san(t),n=h.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);e&&n&&(i=n[1],r=n[2],s=n[3],o=n[4]);for(var a=this.generate_moves(),p=0,f=a.length;p<f;p++){if(h===this.stripped_san(this.move_to_san(a[p]))||e&&h===this.stripped_san(this.move_to_san(a[p],!0)))return a[p];if(n&&(!i||i.toLowerCase()===a[p].piece)&&this.SQUARES[r]===a[p].from&&this.SQUARES[s]===a[p].to&&(!o||o.toLowerCase()===a[p].promotion))return a[p]}},i.prototype.rank=function(t){return t>>4},i.prototype.file=function(t){return 15&t},i.prototype.algebraic=function(t){var e=this.file(t),i=this.rank(t);return"abcdefgh".substring(e,e+1)+"87654321".substring(i,i+1)},i.prototype.swap_color=function(e){return e===t.Colour.WHITE?t.Colour.BLACK:t.Colour.WHITE},i.prototype.is_digit=function(t){return-1!=="0123456789".indexOf(t)},i.prototype.make_pretty=function(t){var e=this.clone(t);e.san=this.move_to_san(e,!1),e.to=this.algebraic(e.to),e.from=this.algebraic(e.from);var i="";for(var r in this.BITS)this.BITS[r]&e.flags&&(i+=this.FLAGS[r]);return e.flags=i,e},i.prototype.clone=function(t){var e=t instanceof Array?[]:{};for(var i in t)e[i]="object"==typeof i?this.clone(t[i]):t[i];return e},i.prototype.trim=function(t){return t.replace(/^\s+|\s+$/g,"")},i.prototype.perft=function(t){for(var e=this.generate_moves({legal:!1}),i=0,r=this.turn,s=0,o=e.length;s<o;s++){if(this.make_move(e[s]),!this.king_attacked(r))if(t-1>0)i+=this.perft(t-1);else i++;this.undo_move()}return i},i.prototype.getSquares=function(){for(var t=[],e=this.SQUARES.a8;e<=this.SQUARES.h1;e++)136&e?e+=7:t.push(this.algebraic(e));return t},i.prototype.getMoves=function(t){for(var e=this.generate_moves(t),i=[],r=0,s=e.length;r<s;r++)void 0!==t&&"verbose"in t&&t.verbose?i.push(this.make_pretty(e[r])):i.push(this.move_to_san(e[r],!1));return i},Object.defineProperty(i.prototype,"in_draw",{get:function(){return this.half_moves>=100||this.in_stalemate()||this.insufficient_material()||this.in_threefold_repetition()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"game_over",{get:function(){return this.half_moves>=100||this.in_checkmate()||this.in_stalemate()||this.insufficient_material()||this.in_threefold_repetition()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fen",{get:function(){return this.generate_fen()},enumerable:!1,configurable:!0}),i.prototype.getPgn=function(t){var e="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\n",i="object"==typeof t&&"number"==typeof t.max_width?t.max_width:0,r=[],s=!1;for(var o in this.header)r.push("["+o+' "'+this.header[o]+'"]'+e),s=!0;s&&history.length&&r.push(e);for(var h=[];history.length>0;)h.push(this.undo_move());for(var n=[],a="";h.length>0;){var p=h.pop();history.length||"b"!==p.color?"w"===p.color&&(a.length&&n.push(a),a=this.move_number+"."):a=this.move_number+". ...",a=a+" "+this.move_to_san(p,!1),this.make_move(p)}if(a.length&&n.push(a),void 0!==this.header.Result&&n.push(this.header.Result),0===i)return r.join("")+n.join(" ");for(var f=0,l=0;l<n.length;l++)f+n[l].length>i&&0!==l?(" "===r[r.length-1]&&r.pop(),r.push(e),f=0):0!==l&&(r.push(" "),f++),r.push(n[l]),f+=n[l].length;return r.join("")},i.prototype.load_pgn=function(t,e){var i=void 0!==e&&"sloppy"in e&&e.sloppy;function r(t){return t.replace(/\\/g,"\\")}var s="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",o=new RegExp("^(\\[(.|"+r(s)+")*\\])("+r(s)+")*1.("+r(s)+"|.)*$","g"),h=t.replace(o,"$1");"["!==h[0]&&(h=""),this.reset();var n=function(t,e){for(var i="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",s={},o=t.split(new RegExp(r(i))),h="",n="",a=0;a<o.length;a++)h=o[a].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),n=o[a].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),this.trim(h).length>0&&(s[h]=n);return s}(h,e);for(var a in n)this.set_header([a,n[a]]);if(!("1"!==n.SetUp||"FEN"in n&&this.load(n.FEN)))return!1;var p=t.replace(h,"").replace(new RegExp(r(s),"g")," ");p=p.replace(/(\{[^}]+\})+?/g,"");for(var f=/(\([^\(\)]+\))+?/g;f.test(p);)p=p.replace(f,"");p=(p=(p=p.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"");var l=this.trim(p).split(new RegExp(/\s+/));l=l.join(",").replace(/,,+/g,",").split(",");for(var u="",c=0;c<l.length-1;c++){if(void 0===(u=this.move_from_san(l[c],i)))return!1;this.make_move(u)}if(u=l[l.length-1],this.POSSIBLE_RESULTS.indexOf(u)>-1)(function(t){for(var e in t)return!0;return!1})(this.header)&&void 0===this.header.Result&&this.set_header(["Result",u]);else{if(void 0===(u=this.move_from_san(u,i)))return!1;this.make_move(u)}return!0},i.prototype.getHeader=function(){return this.set_header(arguments)},i.prototype.move=function(t,e){var i,r=void 0!==e&&"sloppy"in e&&e.sloppy;if("string"==typeof t)i=this.move_from_san(t,r);else if("object"==typeof t)for(var s=this.generate_moves(),o=0,h=s.length;o<h;o++)if(t.from===this.algebraic(s[o].from)&&t.to===this.algebraic(s[o].to)&&(!("promotion"in s[o])||t.promotion===s[o].promotion)){i=s[o];break}if(i){var n=this.make_pretty(i);return this.make_move(i),this.onChange.emit(),n}},i.prototype.undo=function(){var t=this.undo_move();return this.onChange.emit(),t?this.make_pretty(t):void 0},i.prototype.square_color=function(t){if(t in this.SQUARES){var e=this.SQUARES[t];return(this.rank(e)+this.file(e))%2==0?"light":"dark"}},i.prototype.getHistory=function(t){for(var e=[],i=[],r=(void 0!==t&&"verbose"in t&&t.verbose);history.length>0;)e.push(this.undo_move());for(;e.length>0;){var s=e.pop();r?i.push(this.make_pretty(s)):i.push(this.move_to_san(s)),this.make_move(s)}return i},i}(),h=function(){},n=function(){};t.Chess=o,t.ChessPiece=n,t.FenValidationResult=h,t.Move=s,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=chess-ts.umd.min.js.map